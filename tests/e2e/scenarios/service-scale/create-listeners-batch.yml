---
- name: Creating listeners for batch {{ batch_indices | first }}..{{ batch_indices | last }}
  skupper.v2.resource:
    namespace: "{{ namespace_prefix }}-{{ namespace_name }}"
    kubeconfig: "{{ kubeconfig }}"
    def:
      apiVersion: skupper.io/v2alpha1
      kind: Listener
      metadata:
        name: "{{ service_name_prefix }}-{{ idx }}"
      spec:
        routingKey: "{{ routing_key_prefix }}-{{ idx }}"
        host: "{{ service_name_prefix }}-{{ idx }}"
        port: "{{ (base_listener_port | int) + (idx | int) }}"
  loop: "{{ batch_indices }}"
  loop_control:
    loop_var: idx

- name: Pause between listener batches
  ansible.builtin.pause:
    seconds: "{{ batch_pause_seconds | default(3) | int }}"

