---
- name: Creating connectors for batch {{ batch_indices | first }}..{{ batch_indices | last }}
  skupper.v2.resource:
    namespace: "{{ namespace_prefix }}-{{ namespace_name }}"
    kubeconfig: "{{ kubeconfig }}"
    def:
      apiVersion: skupper.io/v2alpha1
      kind: Connector
      metadata:
        name: "{{ service_name_prefix }}-{{ idx }}"
      spec:
        routingKey: "{{ routing_key_prefix }}-{{ idx }}"
        port: "{{ backend_port | int }}"
        selector: "app={{ backend_app_label }}"
  loop: "{{ batch_indices }}"
  loop_control:
    loop_var: idx

- name: Pause between connector batches
  ansible.builtin.pause:
    seconds: "{{ batch_pause_seconds | default(3) | int }}"

